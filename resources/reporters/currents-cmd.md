---
description: The package has CLI commands and tools for Currents platform
---

# @currents/cmd

### Requirements

* Create an account at https://app.currents.dev
* Obtain the Project Id (see [project-settings.md](../../dashboard/projects/project-settings.md "mention")) and the [record-key.md](../../guides/record-key.md "mention")&#x20;

### Setup

```sh
npm install @currents/cmd --save-dev
```

### Available subcommands

* `upload` command - used to discover the full test suite and upload the test results into the Currents Dashboard
* `api` command - retrieves information about Currents entities
* `cache` command - provides a convenient way to store and receive test artifacts

### Upload test results

Upload test results generated with the [Jest reporter](../../getting-started/ci-setup/github-actions/jest-github-actions.md)

#### Usage

```sh
npx currents upload --project-id=xxx --key=yyy
```

`currents` will upload the results, as follows:

* use `process.env.CURRENTS_REPORT_DIR` or `--reportDir` to read the results previously generated by one of supported reporters, otherwise
* use the most recently created directory named `.currents/[timestamp]-[uuidv4()]` in the current working directory

{% hint style="info" %}
Get familiar with  [ci-build-id.md](../../guides/ci-build-id.md "mention") before using `currents` in CI.&#x20;

It is <mark style="color:yellow;">**important**</mark> to set the `CI Build ID` explicitly using `--ci-build-id` option, if you are using CI sharding or multiple CI machines to parallelize your tests.&#x20;



If not set explicitly, the `CI Build ID` will be set to a random value and it will affect your reporting.
{% endhint %}

#### Example

```sh
# Generate jest results 
$ npx jest --reporters=@currents/jest --reporters=default
[currents]: Run started
[currents]: Report directory is set to - /Users/agoldis/immer/.currents/2024-07-16T20-33-12-555Z-478913e1-1916-499b-8d8d-c08043d50f3d
# ....
[currents]: [__tests__/base.js] - spec results written to file: /Users/agoldis/immer/.currents/2024-07-16T20-33-12-555Z-478913e1-1916-499b-8d8d-c08043d50f3d/instances/Aql-q2CM.json
[currents]: Run completed

# Upload the results to Currents
$ npx currents upload --key=XXX --project-id=C3lBM6
Currents config: {
  projectId: 'C3lBM6',
  recordKey: '*****',
  removeTitleTags: false,
  disableTitleTags: false,
  debug: false
}
Report directory: '.currents/2024-07-16T20-33-12-555Z-478913e1-1916-499b-8d8d-c08043d50f3d'
[root] Run created: 'https://app.currents.dev/run/8466c149d9bbf745'
Script execution finished
âœ¨  Done in 17.96s.
```

#### Configuration

All options apart from `--project-id` and `--key` are optional. Use `--help` flag to list the available options.

* `-k, --key`
  * The record key to record the results to Currents. Read more: [record-key.md](../../guides/record-key.md "mention")
  * Environment variable: `CURRENTS_RECORD_KEY`
  * Type: `string`



* `-p, --project-id`
  * The id of the project for reporting
  * Environment variable: `CURRENTS_PROJECT_ID`
  * Type: `string`



* `--ci-build-id`
  * The id of the build to record the test run. Read more [ci-build-id.md](../../guides/ci-build-id.md "mention")
  * Environment variable: `CURRENTS_CI_BUILD_ID`
  * Type: `string`
  * Default value: `auto:[random-string]`



* `--report-dir`
  * Directory with the test results generated by one of currents reporters
  * Environment variable: `CURRENTS_REPORT_DIR`
  * Type: `string`
  * Default value: `.currents/[timestamp]-[uuidv4]`



* `-t, --tag`
  * Comma-separated tag(s) to attach to the recorded run
  * Environment variable: `CURRENTS_TAG`
  * Type: `string`



* `--disable-title-tags`
  * Disable extracting tags from test title, e.g. `Test name @smoke` would not be tagged with `smoke`
  * Environment variable: `CURRENTS_DISABLE_TITLE_TAGS`
  * Type: `boolean`
  * Default value: `false`



* `--remove-title-tags`
  * Remove tags from test names in Currents, e.g. `Test name @smoke` becomes `Test name` in the dashboard
  * Environment variable: `CURRENTS_REMOVE_TITLE_TAGS`
  * Type: `boolean`
  * Default value: `false`



* `--debug`
  * Enable debug logs
  * Environment variable: `DEBUG=currents*`
  * Type: `boolean`

### Use Currents API

Retrieve information about Currents resources in [JSON](../api/api-resources/) format

{% hint style="info" %}
Please note that the command is experimental and was primarily built to obtain test run data in CI. Its functionality might be extended in the future.
{% endhint %}

#### Usage

Obtain run data using the [ci-build-id.md](../../guides/ci-build-id.md "mention") by running the following command:

```bash
npx currents api get-run --ci-build-id <ci-build-id> --output path/to/save/run.json
```

Obtain the last completed run data, filtered by `--branch` and/or `--tag`, by running the following command:

```bash
npx currents api get-run --branch <branch> --tag <tag-1,tag-2,...tag-n>
```

{% hint style="info" %}
The command requires the `--project-id` and [`--api-key`](../api/api-keys.md#managing-the-api-keys) from Currents to authenticate the request and provide the required data. Alternatively, you can set the `CURRENTS_PROJECT_ID` and `CURRENTS_API_KEY` environment variables.
{% endhint %}

### Cache test artifacts

The `currents cache` command allows you to archive files from specified locations and save them under an ID in Currents storage. It also stores a meta file with configuration data. You can provide the ID manually or it can be generated based on CI environment variables (only GitHub and GitLab are supported).

#### Usage

To cache files, use the following command:

```bash
npx currents cache set --key <record-key> --id <id> --paths <path-1,path-2,...path-n>
```

To download files, use the following command:

```bash
npx currents cache get --key <record-key> --id <id> --output-dir test-results
```

For more examples and usage options, run `npx currents cache --help`

#### Configuration

The cache command comes with some additional CI integration features under the `--presets` flag that can make working with Playwright easier in CI environments.

* `--preset last-run`
  * `set`: this will automatically add [Playwright's .last-run.json](../../guides/re-run-only-failed-tests.md) file to the cache.
  * `get`: this will output additional config for you to use in your CI for [Re-running the last failed tests with Playwright](../../guides/re-run-only-failed-tests.md).
* `--preset-output <file path>`
  * `get`: File to save the preset output (default: `.currents_env`)
* `--pw-output-dir <dir>`
  * `set`: Playwright output directory containing`.last-run.json` (default: `test-results`)
* `--paths <paths>`&#x20;
  * `set`: Comma-separated list of paths to cache
* `--output-dir <dir>`
  * `get`: Directory to extract the cache to

### Troubleshooting

Run the CLI command with the `--debug` argument or prefix it with `DEBUG="currents*"` to obtain detailed information about the command execution process.
